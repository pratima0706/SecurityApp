<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login | Digital Security</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://www.google.com/recaptcha/api.js?render={{ app.config['RECAPTCHA_PUBLIC_KEY'] }}"></script>
</head>
<body data-theme="light">

  <!-- ðŸŒ— Floating Theme Toggle (icon only) -->
  <div class="floating-theme-toggle">
    <span id="theme-icon">ðŸŒž</span>
  </div>

  <div class="auth-container">
    <div class="auth-card glassy">

      <h2>Login to Your Account</h2>


      <form method="POST" id="login-form">
        <!-- Username or Email -->
        <div class="input-icon">
          <span class="icon-left">ðŸ‘¤</span>
          <input type="text" name="email" placeholder="Username or Email" required />
        </div>

        <!-- Password Field -->
        <div class="input-icon">
          <span class="icon-left">ðŸ”’</span>
          <input type="password" id="login-password" name="password" placeholder="Password" autocomplete="off"/>
        </div>

        <!-- Remember Me & Forgot Password -->
        <div class="login-options">
          <label><input type="checkbox" name="remember"> Remember me</label>
          <a href="{{ url_for('forgot_password') }}" class="forgot-link">Forgot Password?</a>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn full-btn g-recaptcha"
                data-sitekey="{{ app.config['6LeJcFcrAAAAAN9X34_z2ZLfVKB19nCEVepUKPdV'] }}"
                data-callback='onSubmit'
                data-action='submit'>Login</button>

        <!-- Sign Up Link -->
        <p class="switch-auth">Don't have an account? <a href="{{ url_for('register') }}">Sign Up</a></p>
      </form>
    </div>
  </div>

  <!-- ðŸ’¡ Theme Toggle Script -->
  <script>
    const icon = document.getElementById('theme-icon');

    icon.addEventListener('click', () => {
      const current = document.body.getAttribute('data-theme');
      const newMode = current === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', newMode);
      localStorage.setItem('theme', newMode);
      icon.textContent = newMode === 'dark' ? 'ðŸŒ™' : 'ðŸŒž';
    });

    const saved = localStorage.getItem('theme') || 'light';
    document.body.setAttribute('data-theme', saved);
    icon.textContent = saved === 'dark' ? 'ðŸŒ™' : 'ðŸŒž';
  </script>

  <script>
    // reCAPTCHA v3 Integration
    function onSubmit(token) {
      document.getElementById("login-form").submit();
    }
  </script>

  <script src="{{ url_for('static', filename='js/password.js') }}"></script>

  <!-- Simple Pop-up/Modal Structure -->
  <div id="message-popup" class="popup-container">
    <div class="popup-content">
      <span class="close-button">&times;</span>
      <p id="popup-message-text"></p>
    </div>
  </div>

  <script>
    // Script to handle flashed messages and display pop-up
    document.addEventListener('DOMContentLoaded', () => {
      const popup = document.getElementById('message-popup');
      const popupMessageText = document.getElementById('popup-message-text');
      const closeButton = document.querySelector('.popup-container .close-button');

      // Capture flashed messages from Flask
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          const messages = JSON.parse('{{ messages | tojson | safe }}');
          // Display the first message in the pop-up
          if (messages.length > 0) {
            popupMessageText.textContent = messages[0];
            popup.style.display = 'flex'; // Show the pop-up
          }
        {% endif %}
      {% endwith %}

      // Close the pop-up when the close button is clicked
      closeButton.addEventListener('click', () => {
        popup.style.display = 'none';
      });

      // Close the pop-up if clicked outside the content
      window.addEventListener('click', (event) => {
        if (event.target === popup) {
          popup.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>